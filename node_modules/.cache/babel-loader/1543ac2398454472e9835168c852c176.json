{"ast":null,"code":"import _regeneratorRuntime from \"E:\\\\NODE_JS\\\\DM\\\\KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"E:\\\\NODE_JS\\\\DM\\\\KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport * as faceapi from 'face-api.js'; // Load models and weights\n\nexport function loadModels() {\n  return _loadModels.apply(this, arguments);\n}\n\nfunction _loadModels() {\n  _loadModels = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee() {\n    var MODEL_URL;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            MODEL_URL = process.env.PUBLIC_URL + '/models';\n            _context.next = 3;\n            return faceapi.loadTinyFaceDetectorModel(MODEL_URL);\n\n          case 3:\n            _context.next = 5;\n            return faceapi.loadFaceLandmarkTinyModel(MODEL_URL);\n\n          case 5:\n            _context.next = 7;\n            return faceapi.loadFaceRecognitionModel(MODEL_URL);\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _loadModels.apply(this, arguments);\n}\n\nexport function getFullFaceDescription(_x) {\n  return _getFullFaceDescription.apply(this, arguments);\n}\n\nfunction _getFullFaceDescription() {\n  _getFullFaceDescription = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(blob) {\n    var inputSize,\n        scoreThreshold,\n        OPTION,\n        useTinyModel,\n        img,\n        fullDesc,\n        _args2 = arguments;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            inputSize = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : 512;\n            // tiny_face_detector options\n            scoreThreshold = 0.5;\n            OPTION = new faceapi.TinyFaceDetectorOptions({\n              inputSize: inputSize,\n              scoreThreshold: scoreThreshold\n            });\n            useTinyModel = true; // fetch image to api\n\n            _context2.next = 6;\n            return faceapi.fetchImage(blob);\n\n          case 6:\n            img = _context2.sent;\n            _context2.next = 9;\n            return faceapi.detectAllFaces(img, OPTION).withFaceLandmarks(useTinyModel).withFaceDescriptors();\n\n          case 9:\n            fullDesc = _context2.sent;\n            return _context2.abrupt(\"return\", fullDesc);\n\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _getFullFaceDescription.apply(this, arguments);\n}\n\nvar maxDescriptorDistance = 0.5;\nexport function createMatcher(_x2) {\n  return _createMatcher.apply(this, arguments);\n}\n\nfunction _createMatcher() {\n  _createMatcher = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(faceProfile) {\n    var members, labeledDescriptors, faceMatcher;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            // Create labeled descriptors of member from profile\n            members = Object.keys(faceProfile);\n            labeledDescriptors = members.map(function (member) {\n              return new faceapi.LabeledFaceDescriptors(faceProfile[member].name, faceProfile[member].descriptors.map(function (descriptor) {\n                return new Float32Array(descriptor);\n              }));\n            }); // Create face matcher (maximum descriptor distance is 0.5)\n\n            faceMatcher = new faceapi.FaceMatcher(labeledDescriptors, maxDescriptorDistance);\n            return _context3.abrupt(\"return\", faceMatcher);\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _createMatcher.apply(this, arguments);\n}","map":{"version":3,"sources":["E:/NODE_JS/DM/KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB/src/api/face.js"],"names":["faceapi","loadModels","MODEL_URL","process","env","PUBLIC_URL","loadTinyFaceDetectorModel","loadFaceLandmarkTinyModel","loadFaceRecognitionModel","getFullFaceDescription","blob","inputSize","scoreThreshold","OPTION","TinyFaceDetectorOptions","useTinyModel","fetchImage","img","detectAllFaces","withFaceLandmarks","withFaceDescriptors","fullDesc","maxDescriptorDistance","createMatcher","faceProfile","members","Object","keys","labeledDescriptors","map","member","LabeledFaceDescriptors","name","descriptors","descriptor","Float32Array","faceMatcher","FaceMatcher"],"mappings":";;AAAA,OAAO,KAAKA,OAAZ,MAAyB,aAAzB,C,CAEA;;AACA,gBAAsBC,UAAtB;AAAA;AAAA;;;;;2BAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AACCC,YAAAA,SADD,GACaC,OAAO,CAACC,GAAR,CAAYC,UAAZ,GAAyB,SADtC;AAAA;AAAA,mBAECL,OAAO,CAACM,yBAAR,CAAkCJ,SAAlC,CAFD;;AAAA;AAAA;AAAA,mBAGCF,OAAO,CAACO,yBAAR,CAAkCL,SAAlC,CAHD;;AAAA;AAAA;AAAA,mBAICF,OAAO,CAACQ,wBAAR,CAAiCN,SAAjC,CAJD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAOP,gBAAsBO,sBAAtB;AAAA;AAAA;;;;;2BAAO,kBAAsCC,IAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA4CC,YAAAA,SAA5C,8DAAwD,GAAxD;AACL;AACIC,YAAAA,cAFC,GAEgB,GAFhB;AAGCC,YAAAA,MAHD,GAGU,IAAIb,OAAO,CAACc,uBAAZ,CAAoC;AACjDH,cAAAA,SAAS,EAATA,SADiD;AAEjDC,cAAAA,cAAc,EAAdA;AAFiD,aAApC,CAHV;AAOCG,YAAAA,YAPD,GAOgB,IAPhB,EASL;;AATK;AAAA,mBAUWf,OAAO,CAACgB,UAAR,CAAmBN,IAAnB,CAVX;;AAAA;AAUDO,YAAAA,GAVC;AAAA;AAAA,mBAcgBjB,OAAO,CACzBkB,cADkB,CACHD,GADG,EACEJ,MADF,EAElBM,iBAFkB,CAEAJ,YAFA,EAGlBK,mBAHkB,EAdhB;;AAAA;AAcDC,YAAAA,QAdC;AAAA,8CAkBEA,QAlBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAqBP,IAAMC,qBAAqB,GAAG,GAA9B;AACA,gBAAsBC,aAAtB;AAAA;AAAA;;;;;2BAAO,kBAA6BC,WAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AACL;AACIC,YAAAA,OAFC,GAESC,MAAM,CAACC,IAAP,CAAYH,WAAZ,CAFT;AAGDI,YAAAA,kBAHC,GAGoBH,OAAO,CAACI,GAAR,CACvB,UAAAC,MAAM;AAAA,qBACJ,IAAI9B,OAAO,CAAC+B,sBAAZ,CACEP,WAAW,CAACM,MAAD,CAAX,CAAoBE,IADtB,EAEER,WAAW,CAACM,MAAD,CAAX,CAAoBG,WAApB,CAAgCJ,GAAhC,CACE,UAAAK,UAAU;AAAA,uBAAI,IAAIC,YAAJ,CAAiBD,UAAjB,CAAJ;AAAA,eADZ,CAFF,CADI;AAAA,aADiB,CAHpB,EAaL;;AACIE,YAAAA,WAdC,GAca,IAAIpC,OAAO,CAACqC,WAAZ,CAChBT,kBADgB,EAEhBN,qBAFgB,CAdb;AAAA,8CAkBEc,WAlBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["import * as faceapi from 'face-api.js';\n\n// Load models and weights\nexport async function loadModels() {\n  const MODEL_URL = process.env.PUBLIC_URL + '/models';\n  await faceapi.loadTinyFaceDetectorModel(MODEL_URL);\n  await faceapi.loadFaceLandmarkTinyModel(MODEL_URL);\n  await faceapi.loadFaceRecognitionModel(MODEL_URL);\n}\n\nexport async function getFullFaceDescription(blob, inputSize = 512) {\n  // tiny_face_detector options\n  let scoreThreshold = 0.5;\n  const OPTION = new faceapi.TinyFaceDetectorOptions({\n    inputSize,\n    scoreThreshold\n  });\n  const useTinyModel = true;\n\n  // fetch image to api\n  let img = await faceapi.fetchImage(blob);\n\n  // detect all faces and generate full description from image\n  // including landmark and descriptor of each face\n  let fullDesc = await faceapi\n    .detectAllFaces(img, OPTION)\n    .withFaceLandmarks(useTinyModel)\n    .withFaceDescriptors();\n  return fullDesc;\n}\n\nconst maxDescriptorDistance = 0.5;\nexport async function createMatcher(faceProfile) {\n  // Create labeled descriptors of member from profile\n  let members = Object.keys(faceProfile);\n  let labeledDescriptors = members.map(\n    member =>\n      new faceapi.LabeledFaceDescriptors(\n        faceProfile[member].name,\n        faceProfile[member].descriptors.map(\n          descriptor => new Float32Array(descriptor)\n        )\n      )\n  );\n\n  // Create face matcher (maximum descriptor distance is 0.5)\n  let faceMatcher = new faceapi.FaceMatcher(\n    labeledDescriptors,\n    maxDescriptorDistance\n  );\n  return faceMatcher;\n}\n"]},"metadata":{},"sourceType":"module"}