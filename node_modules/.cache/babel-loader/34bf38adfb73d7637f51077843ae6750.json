{"ast":null,"code":"import _regeneratorRuntime from \"E:\\\\NODE_JS\\\\DM\\\\KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"E:\\\\NODE_JS\\\\DM\\\\KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"E:\\\\NODE_JS\\\\DM\\\\KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\NODE_JS\\\\DM\\\\KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"E:\\\\NODE_JS\\\\DM\\\\KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"E:\\\\NODE_JS\\\\DM\\\\KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"E:\\\\NODE_JS\\\\DM\\\\KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"E:\\\\NODE_JS\\\\DM\\\\KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB\\\\src\\\\views\\\\VideoInput.js\";\nimport React, { Component } from 'react';\nimport Webcam from 'react-webcam';\nimport { loadModels, getFullFaceDescription, createMatcher } from '../api/face'; // Import face profile\n\nvar JSON_PROFILE = require('../descriptors/bnk48.json');\n\nvar WIDTH = 40;\nvar HEIGHT = 40;\nvar inputSize = 160;\n\nvar VideoInput =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(VideoInput, _Component);\n\n  function VideoInput(props) {\n    var _this;\n\n    _classCallCheck(this, VideoInput);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(VideoInput).call(this, props));\n    _this.componentWillMount =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return loadModels();\n\n            case 2:\n              _context.t0 = _this;\n              _context.next = 5;\n              return createMatcher(JSON_PROFILE);\n\n            case 5:\n              _context.t1 = _context.sent;\n              _context.t2 = {\n                faceMatcher: _context.t1\n              };\n\n              _context.t0.setState.call(_context.t0, _context.t2);\n\n              _this.setInputDevice();\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    _this.setInputDevice = function () {\n      navigator.mediaDevices.enumerateDevices().then(\n      /*#__PURE__*/\n      function () {\n        var _ref2 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee2(devices) {\n          var inputDevice;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.next = 2;\n                  return devices.filter(function (device) {\n                    return device.kind === 'videoinput';\n                  });\n\n                case 2:\n                  inputDevice = _context2.sent;\n\n                  if (!(inputDevice.length < 2)) {\n                    _context2.next = 8;\n                    break;\n                  }\n\n                  _context2.next = 6;\n                  return _this.setState({\n                    facingMode: 'user'\n                  });\n\n                case 6:\n                  _context2.next = 10;\n                  break;\n\n                case 8:\n                  _context2.next = 10;\n                  return _this.setState({\n                    facingMode: {\n                      exact: 'environment'\n                    }\n                  });\n\n                case 10:\n                  _this.startCapture();\n\n                case 11:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function (_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n    };\n\n    _this.startCapture = function () {\n      _this.interval = setInterval(function () {\n        _this.capture();\n      }, 1500);\n    };\n\n    _this.capture =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      var match;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!_this.webcam.current) {\n                _context3.next = 9;\n                break;\n              }\n\n              _context3.next = 3;\n              return getFullFaceDescription(_this.webcam.current.getScreenshot(), inputSize).then(function (fullDesc) {\n                if (!!fullDesc) {\n                  _this.setState({\n                    detections: fullDesc.map(function (fd) {\n                      return fd.detection;\n                    }),\n                    descriptors: fullDesc.map(function (fd) {\n                      return fd.descriptor;\n                    }),\n                    gender: fullDesc.map(function (fd) {\n                      return fd.gender;\n                    }),\n                    age: fullDesc.map(function (fd) {\n                      return fd.age;\n                    })\n                  });\n                }\n              });\n\n            case 3:\n              if (!(!!_this.state.descriptors && !!_this.state.faceMatcher)) {\n                _context3.next = 8;\n                break;\n              }\n\n              _context3.next = 6;\n              return _this.state.descriptors.map(function (descriptor) {\n                return _this.state.faceMatcher.findBestMatch(descriptor);\n              });\n\n            case 6:\n              match = _context3.sent;\n\n              _this.setState({\n                match: match\n              });\n\n            case 8:\n              _this.props.LuuGiaTriKhuonMats2(_this.state.match);\n\n            case 9:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n    _this.webcam = React.createRef();\n    _this.state = {\n      fullDesc: null,\n      detections: null,\n      descriptors: null,\n      faceMatcher: null,\n      match: null,\n      facingMode: null\n    };\n    return _this;\n  }\n\n  _createClass(VideoInput, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      clearInterval(this.interval);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          detections = _this$state.detections,\n          match = _this$state.match,\n          facingMode = _this$state.facingMode;\n      var videoConstraints = null; // let camera = '';\n\n      if (!!facingMode) {\n        videoConstraints = {\n          width: WIDTH,\n          height: HEIGHT,\n          facingMode: facingMode\n        }; // if (facingMode === 'user') {\n        //   camera = 'Front';\n        // } else {\n        //   camera = 'Back';\n        // }\n      }\n\n      var drawBox = null;\n\n      if (!!detections) {\n        drawBox = detections.map(function (detection, i) {\n          var _H = detection.box.height;\n          var _W = detection.box.width;\n          var _X = detection.box._x;\n          var _Y = detection.box._y;\n          return React.createElement(\"div\", {\n            key: i,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 112\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            style: {\n              position: 'absolute',\n              border: 'solid',\n              borderColor: 'blue',\n              height: _H,\n              width: _W,\n              transform: \"translate(\".concat(_X, \"px,\").concat(_Y, \"px)\")\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 113\n            },\n            __self: this\n          }, !!match && !!match[i] ? React.createElement(\"p\", {\n            style: {\n              width: _W,\n              fontSize: 10,\n              marginTop: 0,\n              color: 'black',\n              transform: \"translate(-3px,\".concat(_H, \"px)\")\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 124\n            },\n            __self: this\n          }, match[i]._label, React.createElement(\"br\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 134\n            },\n            __self: this\n          }), \"giới tính :\" + _this2.state.gender, React.createElement(\"br\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 136\n            },\n            __self: this\n          }), \"độ tuôi :\" + Math.ceil(_this2.state.age)) : null));\n        });\n      }\n\n      return React.createElement(\"div\", {\n        className: \"Camera\",\n        style: {\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147\n        },\n        __self: this\n      }, React.createElement(\"i\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          width: WIDTH,\n          height: HEIGHT\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          position: 'relative',\n          width: WIDTH\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }, !!videoConstraints ? React.createElement(\"div\", {\n        style: {\n          position: 'absolute'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159\n        },\n        __self: this\n      }, React.createElement(Webcam, {\n        audio: false,\n        width: WIDTH,\n        height: HEIGHT,\n        ref: this.webcam,\n        screenshotFormat: \"image/jpeg\",\n        videoConstraints: videoConstraints,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      })) : null, !!drawBox ? drawBox : null))));\n    }\n  }]);\n\n  return VideoInput;\n}(Component);\n\nexport default VideoInput;","map":{"version":3,"sources":["E:/NODE_JS/DM/KCPM_K15A_WEBSITE_NHAN_DIEN_GT_VB/src/views/VideoInput.js"],"names":["React","Component","Webcam","loadModels","getFullFaceDescription","createMatcher","JSON_PROFILE","require","WIDTH","HEIGHT","inputSize","VideoInput","props","componentWillMount","faceMatcher","setState","setInputDevice","navigator","mediaDevices","enumerateDevices","then","devices","filter","device","kind","inputDevice","length","facingMode","exact","startCapture","interval","setInterval","capture","webcam","current","getScreenshot","fullDesc","detections","map","fd","detection","descriptors","descriptor","gender","age","state","findBestMatch","match","LuuGiaTriKhuonMats2","createRef","clearInterval","videoConstraints","width","height","drawBox","i","_H","box","_W","_X","_x","_Y","_y","position","border","borderColor","transform","fontSize","marginTop","color","_label","Math","ceil","display","flexDirection","alignItems"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Webcam from 'react-webcam';\nimport { loadModels, getFullFaceDescription, createMatcher } from '../api/face';\n\n// Import face profile\nconst JSON_PROFILE = require('../descriptors/bnk48.json');\n\nconst WIDTH = 40;\nconst HEIGHT = 40;\nconst inputSize = 160;\n\nclass VideoInput extends Component {\n  constructor(props) {\n    super(props);\n    this.webcam = React.createRef();\n    this.state = {\n      fullDesc: null,\n      detections: null,\n      descriptors: null,\n      faceMatcher: null,\n      match: null,\n      facingMode: null\n    };\n  }\n\n  componentWillMount = async () => {\n    await loadModels();\n    this.setState({ faceMatcher: await createMatcher(JSON_PROFILE) });\n    this.setInputDevice();\n  };\n\n  setInputDevice = () => {\n    navigator.mediaDevices.enumerateDevices().then(async devices => {\n      let inputDevice = await devices.filter(\n        device => device.kind === 'videoinput'\n      );\n      if (inputDevice.length < 2) {\n        await this.setState({\n          facingMode: 'user'\n        });\n      } else {\n        await this.setState({\n          facingMode: { exact: 'environment' }\n        });\n      }\n      this.startCapture();\n    });\n  };\n\n  startCapture = () => {\n    this.interval = setInterval(() => {\n      this.capture();\n    }, 1500);\n  };\n\n  componentWillUnmount() {\n    clearInterval(this.interval);\n  }\n\n  capture = async () => {\n    if (!!this.webcam.current) {\n      await getFullFaceDescription(\n        this.webcam.current.getScreenshot(),\n        inputSize\n      ).then(fullDesc => {\n        if (!!fullDesc) {\n          this.setState({\n            detections: fullDesc.map(fd => fd.detection),\n\t\t\t\t\t\tdescriptors: fullDesc.map(fd => fd.descriptor),\n\t\t\t\t\t\tgender : fullDesc.map(fd => fd.gender),\n            age : fullDesc.map(fd => fd.age)\n          });\n        }\n      });\n\n      if (!!this.state.descriptors && !!this.state.faceMatcher) {\n        let match = await this.state.descriptors.map(descriptor =>\n\t\t\t\t\tthis.state.faceMatcher.findBestMatch(descriptor)\n        );\n        this.setState({ match });\n\t\t\t}\n\t\t\tthis.props.LuuGiaTriKhuonMats2(this.state.match);\n\t\t}\n\t};\n\n\n  render() {\n    const { detections, match, facingMode } = this.state;\n    let videoConstraints = null;\n    // let camera = '';\n    if (!!facingMode) {\n      videoConstraints = {\n        width: WIDTH,\n        height: HEIGHT,\n        facingMode: facingMode\n      };\n      // if (facingMode === 'user') {\n      //   camera = 'Front';\n      // } else {\n      //   camera = 'Back';\n      // }\n    }\n\n    let drawBox = null;\n    if (!!detections) {\n      drawBox = detections.map((detection, i) => {\n        let _H = detection.box.height;\n        let _W = detection.box.width;\n        let _X = detection.box._x;\n        let _Y = detection.box._y;\n        return (\n          <div key={i}>\n            <div\n              style={{\n                position: 'absolute',\n                border: 'solid',\n                borderColor: 'blue',\n                height: _H,\n                width: _W,\n                transform: `translate(${_X}px,${_Y}px)`\n              }}\n            >\n              {!!match && !!match[i] ? (\n                <p\n                  style={{\n\t\t\t\t\t\t\t\t\t\twidth: _W,\n\t\t\t\t\t\t\t\t\t\tfontSize:10,\n                    marginTop: 0,\n                    color: 'black',\n                    transform: `translate(-3px,${_H}px)`\n                  }}\n                >\n                  {match[i]._label}\n\t\t\t\t\t\t\t\t\t<br/>\n                  {\"giới tính :\"+ this.state.gender}\n                  <br/>\n                  {\"độ tuôi :\"+Math.ceil(this.state.age)}\n                </p>\n              ) : null}\n            </div>\n          </div>\n        );\n      });\n    }\n\n    return (\n      <div\n        className=\"Camera\"\n        style={{\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center'\n        }}\n      >\n       <i>\n        <div style={{  width: WIDTH,  height: HEIGHT }}>\n          <div style={{ position: 'relative', width: WIDTH }}>\n            {!!videoConstraints ? (\n              <div style={{ position: 'absolute' }}>\n                <Webcam\n                  audio={false}\n                  width={WIDTH}\n                  height={HEIGHT}\n                  ref={this.webcam}\n                  screenshotFormat=\"image/jpeg\"\n                  videoConstraints={videoConstraints}\n                />\n              </div>\n            ) : null}\n            {!!drawBox ? drawBox : null}\n          </div>\n        </div>\n\t\t\t\t</i>\n      </div>\n    );\n  }\n}\n\nexport default (VideoInput);\n"]},"metadata":{},"sourceType":"module"}